<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>월별 자산 대시보드</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <style>
    body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Helvetica,Arial,sans-serif;background:#0b1220;color:#e5e7eb;margin:0}
    .container{max-width:900px;margin:0 auto;padding:16px}
    .card{background:#0f172a;border-radius:16px;padding:16px;margin-bottom:12px;box-shadow:0 10px 20px rgba(0,0,0,.25)}
    h1,h2{margin:8px 0}
    input,button,select{width:100%;padding:12px;border-radius:12px;border:1px solid #1f2937;background:#020617;color:#e5e7eb}
    button{background:#2563eb;border:none;font-weight:700}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px}
    .row{display:flex;gap:8px;align-items:center}
    .muted{color:#94a3b8;font-size:12px}
    .progress{height:10px;background:#020617;border-radius:999px;overflow:hidden}
    .bar{height:100%;background:#22c55e;width:0%}
    table{width:100%;border-collapse:collapse;font-size:12px}
    th,td{border-bottom:1px solid #1f2937;padding:6px;text-align:right}
    th:first-child,td:first-child{text-align:left}
    .hide{display:none}
    @media (max-width:420px){.grid,.grid-3{grid-template-columns:1fr}}
  </style>
</head>
<body>
<div class="container">
  <div id="login" class="card">
    <h1>로그인</h1>
    <input id="pw" type="password" placeholder="비밀번호 입력" />
    <button onclick="login()">입장</button>
  </div>

  <div id="app" class="hide">
    <div class="card">
      <h1>월별 자산 대시보드</h1>
      <div class="muted">기준 통화: KRW · 목표: 300,000,000</div>
      <div class="row" style="margin-top:8px">
        <div style="flex:1">
          <div id="summary"></div>
          <div class="progress"><div id="bar" class="bar"></div></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h2>월별 입력 (26일)</h2>
      <div class="grid">
        <input id="month" type="month" />
        <input id="voo" type="number" placeholder="VOO" />
        <input id="qqqm" type="number" placeholder="QQQM" />
        <input id="cash" type="number" placeholder="비상 현금" />
        <input id="cma" type="number" placeholder="CMA" />
        <input id="kr" type="number" placeholder="국내 주식" />
        <input id="coin" type="number" placeholder="코인" />
      </div>
      <button style="margin-top:8px" onclick="save()">저장(덮어쓰기)</button>
    </div>

    <div class="card">
      <canvas id="line"></canvas>
    </div>
    <div class="card">
      <canvas id="pie"></canvas>
    </div>

    <div class="card">
      <h2>월별 표</h2>
      <table id="tbl"></table>
    </div>

    <div class="card grid">
      <button onclick="downloadXlsx()">엑셀 다운로드</button>
      <input type="file" accept=".xlsx" onchange="uploadXlsx(this)" />
    </div>
  </div>
</div>

<script>
const GOAL = 300000000;
const PASSWORD = '397788';
let data = JSON.parse(localStorage.getItem('assets')||'{}');
let lineChart, pieChart;

function login(){ if(document.getElementById('pw').value===PASSWORD){document.getElementById('login').classList.add('hide');document.getElementById('app').classList.remove('hide');render();} else alert('비밀번호 오류'); }

function save(){
  const m = document.getElementById('month').value;
  if(!m) return alert('월 선택');
  data[m]={voo:+voo.value||0, qqqm:+qqqm.value||0, cash:+cash.value||0, cma:+cma.value||0, kr:+kr.value||0, coin:+coin.value||0};
  localStorage.setItem('assets', JSON.stringify(data));
  render();
}

function render(){
  const months = Object.keys(data).sort();
  const us = months.map(m=> (data[m].voo+data[m].qqqm));
  const cashA = months.map(m=> data[m].cash);
  const cmaA = months.map(m=> data[m].cma);
  const krA = months.map(m=> data[m].kr);
  const coinA = months.map(m=> data[m].coin);
  const total = months.map((_,i)=> us[i]+cashA[i]+cmaA[i]+krA[i]+coinA[i]);

  const latest = total[total.length-1]||0;
  const pct = Math.min(100, (latest/GOAL*100).toFixed(1));
  summary.innerHTML = `<b>총 자산:</b> ${latest.toLocaleString()}원 · <b>달성률:</b> ${pct}% · <b>남은 금액:</b> ${(GOAL-latest).toLocaleString()}원`;
  bar.style.width = pct+'%';

  if(lineChart) lineChart.destroy();
  lineChart = new Chart(document.getElementById('line'),{type:'line',data:{labels:months,datasets:[
    {label:'미국 ETF',data:us},
    {label:'비상 현금',data:cashA},
    {label:'CMA',data:cmaA},
    {label:'국내 주식',data:krA},
    {label:'코인',data:coinA},
    {label:'총합',data:total}
  ]}});

  if(pieChart) pieChart.destroy();
  pieChart = new Chart(document.getElementById('pie'),{type:'pie',data:{labels:['미국 ETF','비상 현금','CMA','국내 주식','코인'],datasets:[{data:[us.at(-1)||0,cashA.at(-1)||0,cmaA.at(-1)||0,krA.at(-1)||0,coinA.at(-1)||0]}]}});

  const tbl = document.getElementById('tbl');
  tbl.innerHTML = '<tr><th>월</th><th>미국 ETF</th><th>비상 현금</th><th>CMA</th><th>국내 주식</th><th>코인</th><th>총합</th></tr>' + months.map(m=>{
    const d=data[m]; const usv=d.voo+d.qqqm; const t=usv+d.cash+d.cma+d.kr+d.coin;
    return `<tr><td>${m}</td><td>${usv.toLocaleString()}</td><td>${d.cash.toLocaleString()}</td><td>${d.cma.toLocaleString()}</td><td>${d.kr.toLocaleString()}</td><td>${d.coin.toLocaleString()}</td><td>${t.toLocaleString()}</td></tr>`;
  }).join('');
}

function downloadXlsx(){
  const rows = Object.keys(data).sort().map(m=>({month:m,voo:data[m].voo,qqqm:data[m].qqqm,cash:data[m].cash,cma:data[m].cma,kr:data[m].kr,coin:data[m].coin}));
  const ws = XLSX.utils.json_to_sheet(rows);
  const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, 'assets');
  XLSX.writeFile(wb, 'assets.xlsx');
}

function uploadXlsx(input){
  const f=input.files[0]; if(!f) return;
  const r=new FileReader(); r.onload=e=>{
    const wb=XLSX.read(e.target.result,{type:'binary'});
    const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
    rows.forEach(r=>{ if(r.month) data[r.month]={voo:+r.voo||0,qqqm:+r.qqqm||0,cash:+r.cash||0,cma:+r.cma||0,kr:+r.kr||0,coin:+r.coin||0};});
    localStorage.setItem('assets', JSON.stringify(data)); render();
  }; r.readAsBinaryString(f);
}
</script>
</body>
</html>